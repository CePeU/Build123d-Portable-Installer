name: build-nsis

# on: [push, pull_request, workflow_dispatch]
on: [workflow_dispatch]

jobs:

  build-nsis-exe:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
    - name: Install deps
      run: |
        choco install 7zip curl
        curl -O https://nsis.sourceforge.io/mediawiki/images/1/18/NsProcess.zip
        curl -O https://nsis.sourceforge.io/mediawiki/images/c/c9/Inetc.zip
        curl -O https://nsis.sourceforge.io/mediawiki/images/1/1c/Nsisunz.zip
        curl -O https://nsis.sourceforge.io/mediawiki/images/1/11/Nsis7z_921.zip
        ls -R
        7z x -o"${{ github.workspace }}\NSIS_Plugins" "${{ github.workspace }}\*.zip"
    - name: list dirs
      run: |
        ls -R
    - name: Create installer
      uses: joncloud/makensis-action@v4.1
      with:
        arguments: "/V3"
        script-file: "Build123dPortableSetup.nsi"
        additional-plugin-paths: |
          ${{ github.workspace }}\NSIS_Plugins\Plugin
          ${{ github.workspace }}\NSIS_Plugins\Plugins
          ${{ github.workspace }}\NSIS_Plugins\_release_unicode
          ${{ github.workspace }}\NSIS_Plugins\Plugins\amd64-unicode
          

        # NsProcess\Plugin\
        # Inetc\Plugins\
        # Nsisunz\nsisunz\Release\
        # Nsis7z_921\

  # TODO: publishing        
  # publish-nsis:
